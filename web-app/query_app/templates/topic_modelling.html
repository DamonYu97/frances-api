{% extends 'base.html' %}

{% block content %}
<style>
form.search_form input[type=text] {
  padding: 10px;
  font-size: 17px;
  border: 1px solid grey;
  float: left;
  width: 50%;
  background: #f1f1f1;
}

form.search_form button {
  float: left;
  width: 10%;
  padding: 10px;
  background: #2196F3;
  color: white;
  font-size: 17px;
  border: 1px solid grey;
  border-left: none;
  cursor: pointer;
}

form.search_form button:hover {
  background: #0b7dda;
}

<!--form.search_form::after {
  content: "";
  clear: both;
  display: table;
}-->
</style>

<h3> Topic Modelling Search </h3>
<hr style="width:50%;text-align:left;margin-left:0">
 
    <p> Enter a <strong> topic modelling name </strong> or just the <strong> number </strong> of a topic to see all the terms within the same topic. All topics modelling names start with a number. If not topic is introduced, it will use the first topic modelling, which name starts with '0'.</p>
   <p> We have <strong> {{num_topics}} </strong> topics modelling items.</p>
    
    

     <!-- Load icon library -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- The form -->
        <form method="POST" action="/topic_modelling" class="search_form">
  	<input type="text" placeholder="Topic Name or Number (e.g. 1)" name="topic_name">
  	<button type="submit"><i class="fa fa-search"></i></button>

	</form> 

  {% if results %}
  <br></br>
  <p> <strong>{{num_results}} terms</strong> found for the topic <strong>{{topic_name}}</strong> </p>
  
  <p> Note that if you click over an <strong> URI </strong> in this table, it will take you to the <strong> Visualization of Resources page </strong>. However, if you instead click over a <strong> term </strong>, it will take you to the <strong> Term Search page</strong>, showing all the searching results for that term. </p>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <sript src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  {{ pagination.info }}
  {{ pagination.links }}

    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-inverse">
            <tr> <th> URI </th> <th> Edtion </th> <th> Year </th> <th> Volume </th> <th> Term </th> <th> Definition</th> <th> Sentiment_Score </th> </tr>
        </thead>
        <tbody>
            {% for key, value in results.items() %}
               <tr>
                    <th> <script>
                         var t_key="{{key}}".split("/").pop();
                         if ("{{key}}".includes("Article")){
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{key}}"+'</a>');
                             }
                         else{
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{key}}"+'</a>');
                             }
                         </script>
                     </th>
                       {% for elemen in value %}
                          <td> <script>
                          var loop_ind = "{{loop.index}}" ;
                          var src = "{{elemen}}"; 
                          var t = escapeUnicode(src);
                          if (loop_ind == "4"){
                                document.write('<a href=/term_search/'+t + '>'+ t+'</a>');
                          }
                          else {       
                          var minimize_character_count = 100;    
                          if(t.length > minimize_character_count ){
                          document.write(
                           t.slice(0,minimize_character_count )+'<span>... </span><a href="#" class="more">More</a>'+
                           '<span style="display:none;">'+ t.slice(minimize_character_count ,t.length)+' <a href="#" class="less">Less</a></span>'
                          );
                           }
                          else {
                                  document.write(t);
                                }
                           }
                          $('a.more').click(function(event){
        		    event.preventDefault();
        		    $(this).hide().prev().hide();
        		    $(this).next().show();        
                           });

                           $('a.less').click(function(event){
                           event.preventDefault();
                           $(this).parent().hide().prev().show().prev().show();    
                           });
                           function escapeUnicode(str) {
  return str.replace(/[\u00A0-\uffff]/gu, function (c) {
    return "\\u" + ("000" + c.charCodeAt().toString(16)).slice(-4)
  });
}
	                 </script></td>
                      {% endfor %}
               </tr>
            {% endfor %}
        </tbody>
    </table>
  {{ pagination.links }}
   
<h4> Topic Modelling Visualizations </h4>
<hr style="width:50%;text-align:left;margin-left:0">
 <p> We are visualizing the topic model <strong>{{topic_name}}</strong>. For each topic model, we plot their most common 10 words , along with their <a href="https://maartengr.github.io/BERTopic/api/ctfidf.html"> c-TF-IDF scores </a>.</p>  

   <div class="chart" id="bargraph">
    <script>
        var graphs = {{bar_plot | safe}};
        Plotly.plot('bargraph',graphs,{});
    </script>
   </div>
 </div>
{% endif %}
{% endblock %}

