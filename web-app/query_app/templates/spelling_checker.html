{% extends 'base.html' %}

{% block content %}
<style>
form.search_form input[type=text] {
  padding: 10px;
  font-size: 17px;
  border: 1px solid grey;
  float: left;
  width: 50%;
  background: #f1f1f1;
}

form.search_form button {
  float: left;
  width: 10%;
  padding: 10px;
  background: #2196F3;
  color: white;
  font-size: 17px;
  border: 1px solid grey;
  border-left: none;
  cursor: pointer;
}

.formfield * {
  vertical-align: text-top;
}

form.search_form button:hover {
  background: #0b7dda;
}

<!--form.search_form::after {
  content: "";
  clear: both;
  display: table;
}-->
</style>

<h4> Spelling Checker </h4>
<hr style="width:50%;text-align:left;margin-left:0">
    
    <p> Enter an <strong> URI of a term </strong> that you would like to check its spelling</p>
 
     <!-- Load icon library -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- The form -->
        <form method="POST" action="/spelling_checker" class="search_form">
  	<input type="text" placeholder="Place an URI" name="resource_uri">
  	<button type="submit"><i class="fa fa-search"></i></button>

	</form> 

  {% if results %}
  <br></br>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <sript src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>

    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-inverse">
            <tr> <th> URI </th> <th> Edtion </th> <th> Year </th> <th> Volume </th> <th> Term </th> </tr>
        </thead>
        <tbody>
            {% for key, value in results.items() %}
               <tr>
                    <th> <script>
                         var t_key="{{key}}".split("/").pop();
                         if ("{{key}}".includes("Article")){
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{key}}"+'</a>');
                             }
                         else{
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{key}}"+'</a>');
                             }
                         </script>
                     </th>
                       {% for elemen in value %}
                          <td> {{elemen}} </td> 
	                 </script></td>
                      {% endfor %}
               </tr>
            {% endfor %}
        </tbody>
    </table>
  
<script>
    function compare() {
     var elm1 = "{{definition}}", 
        elm2=   "{{clean_definition}}",
        txt1 = elm1.trim().replace(/\s+/g, ' '),
        txt2 = elm2.trim().replace(/\s+/g, ' '),
        arr1 = txt1.split(" "),
        arr2 = [];

    for (var i in arr1) {
        var match = txt2.match(new RegExp("\\b" + arr1[i] + "\\b"));
        if (match) {
            txt2 = txt2.replace(new RegExp("\\s?" + arr1[i]), "");
            txt1 = txt1.replace(new RegExp("\\s?" + arr1[i]), "");
        } else if (!match) {
            arr2.push(arr1[i]);
        }
    }
    var arr3 = txt2.split(" "),
        right = elm1,
        wrong = elm2;
    for (var a in arr2) {
        for (var b in arr3) {
            var match2 = arr3[b].match(new RegExp("[" + arr2[a] + "]", "g")),
                t = Math.max(arr2[a].length, arr3[b].length);
            if (match2 && match2.length >= t * 0.5) {
                txt2 = txt2.replace(new RegExp("\\s?" + arr3[b]), "");
                txt1 = txt1.replace(new RegExp("\\s?" + arr2[a]), "");
                var str1 = "",
                    str2 = "",
                    n = 0;
                for (var c = 0; c < t; c++) {
                    if (arr2[a].charAt(c) === arr3[b].charAt(c + n)) {
                        str1 += arr3[b].charAt(c + n);
                        str2 += arr2[a].charAt(c);
                    } else if (arr2[a].charAt(c) !== arr3[b].charAt(c + n)) {
                        if(arr2[a].charAt(c + 1) == arr3[b].charAt(c + n)){
                            str2 += arr2[a].charAt(c).fontcolor("blue");
                            str1 += "_".fontcolor("red");
                            n--;
                        }else if(arr2[a].charAt(c) == arr3[b].charAt(c + n + 1)){
                            str1 += arr3[b].charAt(c + n).fontcolor("orange");
                            n++;
                            c--;
                        }else{
                            str1 += arr3[b].charAt(c + n).fontcolor("red");
                            str2 += arr2[a].charAt(c).fontcolor("green");
                        }
                    }
                }
                wrong = wrong.replace(arr3[b], str1);
                right = right.replace(arr2[a], str2);
            }
        }
    }
    extra = txt2.split(" ");
    for(var d in extra){
        wrong = wrong.replace(extra[d], extra[d].fontcolor("grey"));
    }
    missing = txt1.split(" ");
    for(var f in missing){
        right = right.replace(missing[f], missing[f].fontcolor("blue"));
    }
    divColLeft.innerHTML = right;
    divColRight.innerHTML = wrong;

        }

</script>

<script>
    function reset() {
    divColRight.innerHTML = "{{clean_definition}}";
    divColLeft.innerHTML = "{{definition}}";
    }
</script>



<p><strong> Original </strong><input type="button" onClick="compare();" value="Compare" id=""/> <input type="button" onClick="reset();" value="Reset" id=""/></p>
<div id="divColLeft">{{definition}}</div>

<hr style="width:50%;text-align:left;margin-left:0">
<p><strong> Cleaned </strong></p>
<div id="divColRight">{{clean_definition}}</div>


{% endif %}
{% endblock %}
