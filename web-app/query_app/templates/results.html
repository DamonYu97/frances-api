{% extends "home.html" %}
    {% block head %}
     {% endblock %}

{% block content %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
{{ super() }}
<br></br>
<p>Results for <strong>{{term}}</strong> </p>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  {{ pagination.info }}
  {{ pagination.links }}
    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-inverse">
            <tr><th>URI</th>{% for v in headers %}<th>{{ v }}</th>{% endfor %}</tr>
        </thead>
        <tbody>
            {% for key, value in results.items() %}
               <tr>
                    <th> <script>
                         var t_key="{{key}}".split("/").pop();
                         if ("{{key}}".includes("Article")){
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{key}}"+'</a>');
                             }
                         else{
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{key}}"+'</a>');
                             }
                         </script>
                     </th>
                       {% for elemen in value %}
                          <td>
                          <script>
                          var loop_ind = "{{loop.index}}"
                          if ((loop_ind == "4")||(loop_ind == "5")){
                             var info = [{% for item in elemen %} "{{item}}", {%endfor %}];
                             var pageurl=info[0] ; 
                             var t = info[1] ;
                             document.write('<a href="' + pageurl + '">'+t+'</a>');
                          }
                          else if (loop_ind == "8") {
                          	{% for r_term in elemen %} document.write('<a href=/term_search/'+"{{r_term}}"+ '>'+"{{r_term}}"+'</a>'+" "); {%endfor %}
                          }
                          else if (loop_ind == "9") {
                               var topic_name = "{{elemen}}";        
                               document.write('<a href=/topic_modelling?topic_name='+topic_name + '>'+ topic_name+'</a>');
                          }
                          else {
                          var t = "{{elemen}}";        
                          var minimize_character_count = 100;    
                          if(t.length > minimize_character_count ){
                          document.write(
                           t.slice(0,minimize_character_count )+'<span>... </span><a href="#" class="more">More</a>'+
                           '<span style="display:none;">'+ t.slice(minimize_character_count ,t.length)+' <a href="#" class="less">Less</a></span>'
                          );
                           }
                          else {
                          var t = "{{elemen}}";        
                                  document.write(t);
                                }
                          $('a.more').click(function(event){
        		    event.preventDefault();
        		    $(this).hide().prev().hide();
        		    $(this).next().show();        
                           });

                           $('a.less').click(function(event){
                           event.preventDefault();
                           $(this).parent().hide().prev().show().prev().show();    
                           });

                              }
	                 </script></td>
                       {% endfor %}
               </tr>
            {% endfor %}
        </tbody>
    </table>


  
  {{ pagination.links }}
  

 {% if bar_plot %}

<h4> Topic Modelling Visualizations </h4>
<hr style="width:50%;text-align:left;margin-left:0">

 <p> We are visualising each topic model found in our tearm-search. For each topic model, we plot their most common 10 words , along with their <a href="https://maartengr.github.io/BERTopic/api/ctfidf.html"> c-TF-IDF scores </a>.</p>  

 <p> Note that the topic that starts with "-1" refers to all outliers and should typically be ignored. </p>
   <div class="chart" id="bargraph">
    <script>
        var graphs = {{bar_plot | safe}};
        Plotly.plot('bargraph',graphs,{});
    </script>
   </div>
 {% endif %}
 {% if heatmap_plot %}
 <p> We are also going to visualize how similar each topic model is to each other. </p>
   <div class="chart" id="heatmap">
    <script>
        var graphs = {{heatmap_plot | safe}};
        Plotly.plot('heatmap',graphs);
    </script>
  </div>
 </div>
 {% endif %}




{% endblock %}
