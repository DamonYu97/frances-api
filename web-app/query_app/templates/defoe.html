{% extends 'base.html' %}

{% block content %}
<style>
form.search_form input[type=text] {
  padding: 10px;
  font-size: 17px;
  border: 1px solid grey;
  float: left;
  width: 50%;
  background: #f1f1f1;
}

form.search_form button {
  float: left;
  width: 10%;
  padding: 10px;
  background: #2196F3;
  color: white;
  font-size: 17px;
  border: 1px solid grey;
  border-left: none;
  cursor: pointer;
}

form.search_form button:hover {
  background: #0b7dda;
}

<!--form.search_form::after {
  content: "";
  clear: both;
  display: table;
}-->
</style>

<h3> Defoe Queries </h3>
<hr style="width:50%;text-align:left;margin-left:0">
 
    {% if not defoe_selection %}
    

   	<p> Select the <strong> defoe query </strong> that you would to run. Depending on the selected query, different configurations will be available for you.</p>
     	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     	<!-- Load icon library -->
         <form action ="/config_query" method = "POST" enctype="multipart/form-data">
            <div>
    	     <label for="defoe_selection">Defoe query</label>
             <select name="defoe_selection" id="defoe_selection"> 
                {% for key, value in defoe_q.items() %}
	         <option value="{{key}}">{{ value }}</option>
		 {% endfor %}
              </select>
              </div> 
             <p> Click here to configure your query. </p>
            <input type="submit" value="Config Defoe Query">
         </form>

     {% endif %}  

     {% if config_options %}

         <form action ="/run_queries" method = "POST" enctype="multipart/form-data" id="run_queries">
                 <div>
    	         <label for="defoe_selection">Defoe query</label>
                  <select name="defoe_selection" id="defoe_selection"> 
	             <option value="{{defoe_selection}}">{{ defoe_selection }}</option>
                 </select> 
                 </div>
	
                <p> The <strong> {{defoe_selection}} </strong> query {{defoe_def}} </p> 
                
                {% if config_options["preprocess"] %}
                	<hr style="width:50%;text-align:left;margin-left:0"> 
                	<div>
    	        	<label for="preprocess">Preprocess Treatment</label> <br>
			<input type="radio" id="none" name="preprocess" value="none">
  				<label for="none">None</label><br>
  			<input type="radio" id="normalize" name="preprocess" value="normalize">
  				<label for="normalize">Normalize</label><br>
  			<input type="radio" id="normalize_num" name="preprocess" value="normalize_num">
  				<label for="normalize_num">Normalize & Numbers</label> <br>
  			<input type="radio" id="lemmatize" name="preprocess" value="lemmatize" checked="checked">
  				<label for="lemmatize">Normalize & Lemmatize</label><br>
  			<input type="radio" id="stem" name="preprocess" value="stem">
  				<label for="stem">Normalize & Stemming</label> <br>
                	</div>
               {% endif %}
               {% if config_options["hit_count"] %}
                	<hr style="width:50%;text-align:left;margin-left:0">
                	<div>
    	         	<label for="hit_count">Select the hit count</label>
                 	<select name="hit_count" id="hit_count">
	         	<option value=term>term</option>
	         	<option value=word>word</option>
                 	</select> <br>
                 	</div>
                {% endif %}
                
                {% if config_options["lexicon"] %}
                	<hr style="width:50%;text-align:left;margin-left:0">
                	<div>
    	         	<label for="data">Upload your lexicon file</label>
                 	<input type = "file" name = "file" >
                	</div> <br>
                {% endif %}
             
                {% if config_options["target_sentences"] %}
                	 <hr style="width:50%;text-align:left;margin-left:0">
  	         	<div>
                
    	          	<label for="target_sentences">Introduce Target words/sentences separated by "," (Optional)</label><br>
                        <textarea form="run_queries" name="target_sentences" id="target_sentences" rows="10" cols="35"></textarea><br>

                 
    	          	<label for="target_filter"> Select the Target filter </label> <br> 
			<input type="radio" id="or" name="target_filter" value="or" checked="checked">
  			<label for="or"> OR: Select terms which contains <strong> any </strong> of the target words/sentences </label><br>
  			<input type="radio" id="and" name="target_filter" value="and">
  			<label for="and"> AND: Select terms which contains <strong> all </strong> the target words/sentences </label><br>
                 	</div><br>
                 {% endif %}
                 
               	{% if config_options["start_year"] %}
                	<hr style="width:50%;text-align:left;margin-left:0">
  	         	<div>
                  	<label for="start_year">Start Year (Optional)</label>
                  	<input type="text" id="start_year" name="start_year" value=1771>
                  	<label for="end_year">End Year (Optional)</label>
                  	<input type="text" id="end_year" name="end_year" value=1771>
                 	</div> <br>
               {% endif %}
         
               {% if config_options["window"] %}
               		<hr style="width:50%;text-align:left;margin-left:0">
  	       		<div>
               		<label for="window"> Snippet Window </label>
               		<input type="text" id="window" name="window" value=10>
               		</div> <br>
               {% endif %}
         
           <hr style="width:50%;text-align:left;margin-left:0">
           <p> Click here when you are ready to submit your query. </p>
           <input type="submit" value="Submit Defoe query"> 
           </form>

           <hr style="width:50%;text-align:left;margin-left:0">
           <form action="/defoe_queries">
           <div>
               <p> Click here, if you would like to start again, and select a different query. </p>
               <input type="submit" value="Reset Configurations">
           </div> <br>
           </form>

   {% endif %}

   {% if flag %}
        
      <p> The <strong> {{defoe_selection}} </strong> query {{defoe_def}} </p> 
      <hr style="width:50%;text-align:left;margin-left:0">
	
       <h4> Results of  {{defoe_selection}} query</h4>
       <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
       <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
       {% if "normalized" not in defoe_selection %} 
       	<p> Your configurations: </p>
       	<ul>
		{% for key, value in config.items() %}
                      
           		{% if "defoe_path" not in key and "os_type" not in key and value!=None %}
                                <script>
                                   t_value="{{value}}".split("/").pop();
                                   if ("{{key}}".includes("data")) {
                                     
                                         document.write( '<li> <strong> ' + "{{key}}" + ' </strong>: '+ t_value + ' </li>');
                                   }
                                   else {
                                         document.write( '<li> <strong> ' + "{{key}}" + '</strong>: '+ "{{value}}" +'  </li>');
                                        }
                                </script>
           		{% endif %}
        	{% endfor %}         
       </ul>
       {% endif %}

        {% if "frequency" in defoe_selection %}
      		<p> Here we can see the frequency of your lexicon words/sentences taking into account the target workds/sentences (if any) and other configurations, sorted by years.</p>
        	<table class="table table-striped table-bordered table-hover">
        	<thead class="thead-inverse">
            	<tr> <th> Year </th> <th> Keyword : Frequency </th> </tr>
        	</thead>
        	<tbody>
            	{% for key, value in results.items() %}
               	<tr>
                    <th> {{key}} </th>
                    <td> 
                          <ul>
                          {% for elemen in value %}
                                <li> 
                                     {{elemen[0]}} : {{elemen[1]}}
                                </li>

                          {% endfor %}
                          </ul>
                     </td> 
                 </tr>
                {% endfor %}
          	</tbody>
         	</table>
            	<script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
         	<br></br>
          	{% if line_f_plot %}
               		<div class="chart" id="line_f_plot">
                	<script>
                    		var graphs = {{line_f_plot | safe}};
                    		Plotly.plot('line_f_plot',graphs);
                	</script>
              		</div>
               		<div class="chart" id="line_n_f_plot">
                	<script>
                    		var graphs = {{line_n_f_plot | safe}};
                    		Plotly.plot('line_n_f_plot',graphs);
                	</script>
              		</div>
            		<br></br>
          	{% endif %}
        {% elif "normalized" in defoe_selection %}
        	<p> Here we can see the number of documents, pages and words per year.</p>
        	<table class="table table-striped table-bordered table-hover">
        		<thead class="thead-inverse">
            			<tr> <th> Year </th> <th> Num. Documents </th> <th> Num. Pages </th> <th> Num. Words </th> </tr>
        		</thead>
        		<tbody>
            		{% for key, value in results.items() %}
               		<tr>
                    		<th> {{key}} </th>
                    		{% for elemen in value %}
                    		<td>
                         		{{elemen}}
                     		</td> 
                     		{% endfor %}
              		 </tr>
            		{% endfor %}
          		</tbody>
         	</table>
            	<script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
            	<br></br>
        {% else %}
        
            {% if "terms"  in defoe_selection %}
               <p> The <strong> full results are available for download in the bellow link </strong>. Here we list the terms founded in your search. For each those terms, you can see which words or sentences have been found from your lexicon, taking into account the target words/sentences (if any) and as well other configurations. </p>
              	<table class="table table-striped table-bordered table-hover">
              		 <thead class="thead-inverse">
                 		 <tr> <th> Year </th> <th> Data </th> <th> Advanced Options </th></tr>
               		</thead>
               		<tbody>
               		{% for elem in results_uris %}
                	<tr>
                    	<th> <script>
                        	 var t_key="{{elem[0]}}".split("/").pop();
                         	 if ("{{key}}".includes("Article")){
                             		document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{elem[0]}}"+'</a>');
                            	 }
                         	 else{
                             		document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{elem[0]}}"+'</a>');
                             	}
                         	</script>
                        </th>
                    	<td>
                         <ul>
                          {% for elemen in elem[1] %}
                                <li>
                                     {{elemen}}
                                </li>

                          {% endfor %}
                         </ul>
                     	 </td>
                         <td>
                         <script>
                        	var t_key="{{elem[0][0]}}".split("/").pop();
                        	if ("{{key}}".includes("Article")){
                           	document.write('<dl><dt><a href=/spelling_checker?termlink='+t_key + '&termtype=Article>'+ 'Spell Checker </a></dt>');
                           	document.write('<dt><a href=/similar_terms?termlink='+t_key + '&termtype=Article>'+ 'Term Similarity </a></dt>');
                           	document.write('<dt><a href=/evolution_of_terms?termlink='+t_key + '&termtype=Article>'+ 'Term Evolution </a></dt></ul>');
                             	}
                         	else{
                           	document.write('<ul><dt><a href=/spelling_checker?termlink='+t_key + '&termtype=Topic>'+ 'Spell Checker </a></dt>');
                           	document.write('<dt><a href=/similar_terms?termlink='+t_key + '&termtype=Topic>'+ 'Term Similarity </a></dt>');
                           	document.write('<a href=/evolution_of_terms?termlink='+t_key + '&termtype=Topic>'+ 'Term Evolution </a></dt></dl>');

                          	}
                        </script>

                    	</td>
               		</tr>
            		{% endfor %}
          		</tbody>
         		</table>
           		 <script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
            		<br></br>
            {% else %}
               <p> Here we list the terms founded in your search. For each those terms, you can see which words or sentences have been found from your lexicon, taking into account the target words/sentences (if any). </p>
              <table class="table table-striped table-bordered table-hover">
               <thead class="thead-inverse">
                  <tr> <th> Year </th> <th> Data </th> <th> Advanced Options </th></tr>
               </thead>
            	{% for key, value in results.items() %}
               	<tr>
                    <th> <script>
                         var t_key="{{key}}".split("/").pop();
                         if ("{{key}}".includes("Article")){
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{key}}"+'</a>');
                             }
                         else{
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{key}}"+'</a>');
                             }
                         </script>
                    </th> 
                    <td>
                         <ul> 
                          {% for elemen in value %}
                                <li> 
                                     {{elemen}}
                                </li>

                          {% endfor %}
                          </ul>
                     </td>
                    <td>
                        <script>
                        var t_key="{{key}}".split("/").pop();
                        if ("{{key}}".includes("Article")){
                           document.write('<dl><dt><a href=/spelling_checker?termlink='+t_key + '&termtype=Article>'+ 'Spell Checker </a></dt>');  
                           document.write('<dt><a href=/similar_terms?termlink='+t_key + '&termtype=Article>'+ 'Term Similarity </a></dt>');  
                           document.write('<dt><a href=/evolution_of_terms?termlink='+t_key + '&termtype=Article>'+ 'Term Evolution </a></dt></ul>');
                             }
                         else{
                           document.write('<ul><dt><a href=/spelling_checker?termlink='+t_key + '&termtype=Topic>'+ 'Spell Checker </a></dt>');   
                           document.write('<dt><a href=/similar_terms?termlink='+t_key + '&termtype=Topic>'+ 'Term Similarity </a></dt>');  
                           document.write('<a href=/evolution_of_terms?termlink='+t_key + '&termtype=Topic>'+ 'Term Evolution </a></dt></dl>'); 
                             
                          }
                        </script>
             
                    </td>
               </tr>
            {% endfor %}
          </tbody>
         </table>
            <script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
            <br></br>
         {% endif %}
         {% endif %}

           <hr style="width:50%;text-align:left;margin-left:0">
          <form action="/defoe_queries">
               <div>
               <p> Click here to run a new query. </p>
               <input type="submit" value="Restart">
                </div> <br>
          </form>
   {% endif %}

{% endblock %}

