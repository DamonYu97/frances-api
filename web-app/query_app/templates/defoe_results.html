{% extends 'base.html' %}

{% block content %}
<style>

form.search_form input[type=text] {
  padding: 10px;
  font-size: 17px;
  border: hidden;
  float: left;
  width: 50%;
  background: #f1f1f1;
}

.input1 {
        border-top-style: hidden;
        border-right-style: hidden;
        border-left-style: hidden;
        border-bottom-style: hidden;
        background-color: #eee;
      }

form.search_form button {
  float: left;
  width: 10%;
  padding: 10px;
  background: #2196F3;
  color: white;
  font-size: 17px;
  border: 1px solid grey;
  border-left: none;
  cursor: pointer;
}

form.search_form button:hover {
  background: #0b7dda;
}

<!--form.search_form::after {
  content: "";
  clear: both;
  display: table;
}-->
</style>

       <h4> Results of  {{defoe_selection}} query</h4>
       <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
       <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>

        {% if "flag" and "normalized" not in defoe_selection %}
        
        <table class="table table-striped table-bordered table-hover">
        <thead class="thead-inverse">
            <tr> <th> Defoe Configuration Parameters </th> <th>  Values </th></tr>
        </thead>
        <tbody>
            {% for key, value in config.items() %}
               <tr>
                    <th> {{key}} </th>
                    <td> 
                          <ul>
                            {{value}}
                          </ul>
                    </td>
                </tr>
            {% endfor %}
          </tbody>
         </table>


        {% endif %}

        {% if "frequency" in defoe_selection %}
        <p> Here we can see the frequency of your lexicon words/sentences taking into account the target workds/sentences (if any) and other configurations, sorted by years.</p>
        <table class="table table-striped table-bordered table-hover">
        <thead class="thead-inverse">
            <tr> <th> Year </th> <th> Keyword : Frequency <th> </tr>
        </thead>
        <tbody>
            {% for key, value in results.items() %}
               <tr>
                    <th> {{key}} </th>
                    <td> 
                          <ul>
                          {% for elemen in value %}
                                <li> 
                                     {{elemen[0]}} : {{elemen[1]}}
                                </li>

                          {% endfor %}
                          </ul>
                     </td> 
               </tr>
            {% endfor %}
          </tbody>
         </table>
            <script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
         <br></br>
          {% if line_f_plot %}
               <div class="chart" id="line_f_plot">
                <script>
                    var graphs = {{line_f_plot | safe}};
                    Plotly.plot('line_f_plot',graphs);
                </script>
              </div>
               <div class="chart" id="line_n_f_plot">
                <script>
                    var graphs = {{line_n_f_plot | safe}};
                    Plotly.plot('line_n_f_plot',graphs);
                </script>
              </div>
            <br></br>
          {% endif %}
        {% elif "normalized" in defoe_selection %}
        <p> Here we can see the number of volumes, pages and words per year.</p>
        <table class="table table-striped table-bordered table-hover">
        <thead class="thead-inverse">
            <tr> <th> Year </th> <th> Num. Volumes </th> <th> Num. Pages </th> <th> Num. Words </th> </tr>
        </thead>
        <tbody>
            {% for key, value in results.items() %}
               <tr>
                    <th> {{key}} </th>
                    {% for elemen in value %}
                    <td>
                         {{elemen}}
                     </td> 
                     {% endfor %}
               </tr>
            {% endfor %}
          </tbody>
         </table>
            <script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
            <br></br>
         {% elif "uris" in defoe_selection %}
               <p> Here we list the terms uris founded in your search (if any). Results are grouped by Term Uris, meaning that in a term definition we might have more than one keyword/keysearch.  </p>
              <table class="table table-striped table-bordered table-hover">
               <thead class="thead-inverse">
                  <tr> <th> Term Uri </th> <th> Search Terms </th> <th> Advanced Options </th></tr>
               </thead>
               <tbody>
            {% for key, value in results.items() %}
               <tr>
                    <th> <script>
                         var t_key="{{key}}".split("/").pop();
                         if ("{{key}}".includes("Article")){
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{key}}"+'</a>');
                             }
                         else{
                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{key}}"+'</a>');
                             }
                         </script>
                    </th> 
                    <td>
                         <ul> 
                          {% for elemen in value %}
                                <li> 
                                     {{elemen}}
                                </li>

                          {% endfor %}
                          </ul>
                     </td>
                    <td>
                        <script>
                        var t_key="{{key}}".split("/").pop();
                        if ("{{key}}".includes("Article")){
                           document.write('<dl><dt><a href=/spelling_checker?termlink='+t_key + '&termtype=Article>'+ 'Spell Checker </a></dt>');  
                           document.write('<dt><a href=/similar_terms?termlink='+t_key + '&termtype=Article>'+ 'Term Similarity </a></dt>');  
                           document.write('<dt><a href=/evolution_of_terms?termlink='+t_key + '&termtype=Article>'+ 'Term Evolution </a></dt></ul>');
                             }
                         else{
                           document.write('<ul><dt><a href=/spelling_checker?termlink='+t_key + '&termtype=Topic>'+ 'Spell Checker </a></dt>');   
                           document.write('<dt><a href=/similar_terms?termlink='+t_key + '&termtype=Topic>'+ 'Term Similarity </a></dt>');  
                           document.write('<a href=/evolution_of_terms?termlink='+t_key + '&termtype=Topic>'+ 'Term Evolution </a></dt></dl>'); 
                             
                          }
                        </script>
             
                    </td>
               </tr>
            {% endfor %}
          </tbody>
         </table>
            <script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
            <br></br>
        {% else%}
               <p> The <strong>full results are available for download in the bellow link </strong>. Here we have two sets of results: <strong>terms_details</strong> and <strong>terms_uris</strong>. <strong>terms_details</strong> lists the terms founded in your search. For each those terms, you can see which words or sentences have been found from your lexicon, taking into account the target words/sentences (if any) and as well other configurations. Finally, <strong>terms_uris</strong> lists the terms uris founded in your search (if any). In this case, results are grouped by Term Uris, meaning that in a term definition we might have found more than one keyword/keysearch.</p>
              <table class="table table-striped table-bordered table-hover">
               <thead class="thead-inverse">
                  <tr> <th> Result Type </th> <th> Data </th> </tr>
               </thead>
               <tbody>
               {% for key, value in results.items() %}
                  <tr>
                    <th> {{key}}
                    </th> 
                    <td>
                          {% if "terms_details" in key %}
                          	{% for elemen in value %}
                                   <table> 
               				<thead>
                                             <tr> <th> Year  </th> <th> Data </th></tr>
               				</thead>
                                           <tbody>
                                              <tr>
                                                  <th> {{elemen[0]}} </th>
                                              <td>
                                                    <table>
                                                          <thead>
                                                                <tr>{% for k,v in elemen[1][0].items() %}<th>{{ k }}</th>{% endfor %}</tr>

                                                          </thead>
                                                         <tbody>
                                                               {% for el in elemen[1] %}
                                                                <tr>
                                                                        {% for k_el, v_el in el.items() %}
                                                                             <td>
                                                                                 <script>
                                                                                   var t_key="{{v_el}}".split("/").pop();
                                                                                     if ("{{v_el}}".includes("Article")){
                                                                                        document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{v_el}}"+'</a>');
                                                                                         }
                                                                                     else if("{{v_el}}".includes("Topic")){
                                                                                         document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{v_el}}"+'</a>');
                                                                                         }
                                                                                     else{
                                                                                         document.write("{{v_el}}");
                                                                                      }
                                                                              
                                                                                 </script>
                                                                             </td>
                                                                        {% endfor %}
                                                                </tr>
                                                                {% endfor %}
                                                      </tbody>
                                                    </table>
                                               </td>
                                             </tr>
                                          </tbody>
                                      </table>
                          	{% endfor %}
                            {% else %}
                            <table>
                             <thead>
                                <tr> <th> Term Uri </th> <th> Search Terms </th> <th> Advanced Options </th></tr>
                             </thead>
                               <tbody>
                                  {% for el in value %}
                                   <tr>
                                     <th> <script>
                                       var t_key="{{el[0]}}".split("/").pop();
                                          if ("{{el[0]}}".includes("Article")){
                                             document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Article>'+ "{{el[0]}}"+'</a>');
                                              }
                                          else{
                                         document.write('<a href=/visualization_resources?termlink='+t_key + '&termtype=Topic>'+ "{{el[0]}}"+'</a>');
                                            }
                                       </script>
                                     </th>
                                    <td>
                                      <ul>
                                        {% for data in el[1] %}
                                         <li>
                                           {{data}}
                                         </li>

                                        {% endfor %}
                                       </ul>
                                     </td>
                               {% endfor %}
                             </tbody>
                             </table>

                            {% endif %}
                     </td>
                 </tr>
              {% endfor %}
             </tbody>
             </table>
            <script> document.write('<a href=/download?defoe_selection='+"{{defoe_selection}}"+ '> Download Results </a>') </script>
            <br></br>
       {% endif %}
         <form action ="http://localhost:5000/defoe_queries">
         <div>
         <input type="submit" value="Return"> 
         <br>
         <br>
         </div>
          </form>


{% endblock %}

